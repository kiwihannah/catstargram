<!DOCTYPE html>
<html lang="en">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
   integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous" />

<!-- Font Awesome CSS -->
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
   crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<link href="./myStyle.css" rel="stylesheet" />
<!-- <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script> -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
   href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@1,100&family=Inconsolata:wght@200&family=Jua&display=swap"
   rel="stylesheet">
<!------ Include the above in your HEAD tag ---------->

<!-- <script src="./api.js"></script> -->

<script>
   function post_box() {
      $("#post-box").show();
   }

   function getSelf(callback) {
      $.ajax({
         type: "GET",
         url: "/api/user/me",
         headers: {
            authorization: `Bearer ${localStorage.getItem("token")}`,
         },
         success: function (response) {
            callback(response.user);
         },
         error: function (xhr, status, error) {
            if (status == 401) {
               alert("로그인이 필요합니다.");
            } else {
               localStorage.clear();
               alert("알 수 없는 문제가 발생했습니다. 관리자에게 문의하세요.");
            }
            window.location.href = "/";
         },
      });
   }

   $(document).ready(function () {
      $("cmt-box").hide();
      const date = new Date().toLocaleDateString();
      const time = new Date().toLocaleTimeString();
      $("#date").append(date);
      $("#time").append(time);

      const user_id = "33";

      $.ajax({
         type: "GET",
         url: "/api/user/info/" + user_id,
         data: {
            user_id_give: user_id,
         },
         success: function (response) {
            const cat_name = response["user"]["cat_name"];
            $("#cat-name").append(cat_name);
         }
      });

      read_all();
   });

   function new_post() {
      let title = "hannah";
      let context = $("#context").val();
      let img_url = "url";
      let mention = "33";
      $.ajax({
         type: "POST",
         url: "/api/posts",
         data: {
            title_give: title,
            context_give: context,
            img_url_give: img_url,
            mention_give: mention,
         },
         success: function (response) {
            alert("저장되었습니다.");
            window.location.reload();
         },
      });
   }

   function read_all() {
      $("#post-box").empty();
      $.ajax({
         type: "GET",
         url: "/api/posts",
         data: {},
         success: function (response) {
            $("#post-list").empty();
            let posts = response["posts"];
            console.log("[api : read all]");
            let currentPage = response["currentPage"];
            let maxPage = response["maxPage"];
            for (let i = 0; i < posts.length; i++) {
               addList(posts[i]);
            }
         },
      });
   }
   function addList(posts) {
      let temp_html = `<div class="timeline-body" style="padding-top: 10px;">
                           <div class="timeline-header">
                              <span class="userimage"><img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt=""></span>
                              <span class="username"><a href="./userInfo.html">${posts["user_id"]}</a></span>
                              <span class="date"> (${posts["ins_date"]})</span>
                              <span style="float: right">
                                 <button class="fa fa-pencil-square-o btn btn-outline-secondary">edit</button>
                              </span>
                           </div>
                           <div class="timeline-content">
                              <p>${posts["context"]}</p>
                           </div>
                           <div class="timeline-likes">
                              <div class="stats-right">
                                 <span class="stats-text">21 Comments</span>
                              </div>
                              <div class="stats">
                                 <span class="fa-stack fa-fw stats-icon">
                                    <i class="fa fa-circle fa-stack-2x text-primary"></i>
                                    <i class="fa fa-thumbs-up fa-stack-1x fa-inverse"></i>
                                 </span>
                                 <span class="stats-total">4.3k</span>
                              </div>
                           </div>

                           <div class="timeline-footer">
                              <a href="javascript:;" class="m-r-15 text-inverse-lighter"><i class="fa fa-thumbs-up fa-fw fa-lg m-r-3"></i>
                                 따봉</a>
                              <a href="javascript:cmt()" class="m-r-15 text-inverse-lighter"><i class="fa fa-comments fa-fw fa-lg m-r-3"></i>
                                 댓글 펼치기</a>
                           </div>
                           `;
      $("#post-list").append(temp_html);
   }
   
   function newReply() {
      
   }

   function cmt() {
      $("#cmt-box").slideDown("slow");
   }
</script>

<head>
   <!-- Required meta tags -->
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <link rel="icon" href="/favicon.ico" type="image/x-icon" />
   <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
   <title>catstargram</title>
</head>

<body>
   <button onclick="getSelf()" class="btn btn-outline-danger">testing</button>
   <button onclick="location.href='register.html'" class="btn btn-outline-success">가입</button>
   <button onclick="location.href='newPost.html'" class="btn btn-outline-warning">새글</button>
   <div class="timeline" id="post-list">
      <div class="timeline-comment-box" id="cmt-box">
         <div class="user"><img src="https://bootdey.com/img/Content/avatar/avatar6.png"></div>
         <div class="input">
            <form action="">
               <div class="input-group">
                  <input type="text" class="form-control rounded-corner" placeholder="악플달면 죽여버릴거야.">
                  <span class="input-group-btn p-l-10">
                     <button class="btn btn-primary f-s-12 rounded-corner" type="button">댓글달기</button>
                  </span>
               </div>
            </form>
         </div>                   
      </div>
   </div>
</body>

</html>