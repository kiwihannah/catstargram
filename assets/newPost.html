<!DOCTYPE html>
<html lang="en">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
   integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous" />

<!-- Font Awesome CSS -->
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
   crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<link href="./myStyle.css" rel="stylesheet" />
<!-- <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script> -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
   href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@1,100&family=Inconsolata:wght@200&family=Jua&display=swap"
   rel="stylesheet">
<!------ Include the above in your HEAD tag ---------->

<!-- <script src="./api.js"></script> -->

<script>
   function getSelf(callback) {
      $.ajax({
         type: "GET",
         url: "/api/user/me",
         headers: {
            authorization: `Bearer ${localStorage.getItem("token")}`,
         },
         success: function (response) {
            callback(response.user);
         },
         error: function (xhr, status, error) {
            if (status == 401) {
               alert("로그인이 필요합니다.");
            } else {
               localStorage.clear();
               alert("알 수 없는 문제가 발생했습니다. 관리자에게 문의하세요.");
            }
            window.location.href = "/";
         },
      });
   }

   $(document).ready(function () {
      const date = new Date().toLocaleDateString();
      const time = new Date().toLocaleTimeString();
      $("#date").append(date);
      $("#time").append(time);

      const user_id = "33";

      $.ajax({
         type: "GET",
         url: "/api/user/info/" + user_id,
         data: {
            user_id_give: user_id,
         },
         success: function (response) {
            const cat_name = response["user"]["cat_name"];
            $("#cat-name").append(cat_name);
         }
      });

   });

   function new_post() {
      let title = "hannah";
      let context = $("#context").val();
      let img_url = "url";
      let mention = "33";
      $.ajax({
         type: "POST",
         url: "/api/posts",
         data: {
            title_give: title,
            context_give: context,
            img_url_give: img_url,
            mention_give: mention,
         },
         success: function (response) {
            alert("저장되었습니다.");
            window.location.reload();
         },
      });
   }

</script>

<head>
   <!-- Required meta tags -->
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <link rel="icon" href="/favicon.ico" type="image/x-icon" />
   <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
   <title>catstargram</title>
</head>

<body>
   <button onclick="getSelf()">testing</button>
   <div class="float">
      <div class="float">
        <button onclick="window.location.href='/'">홈으로</a>
      </div>
   </div>
   <!-- posting -->
   <div class="timeline">
      <div id="post-box">
         <div class="timeline-time">
            <span class="date" id="date"></span>
            <span class="time" id="time"></span>
         </div>
         <div class="timeline-icon">
            <a href="javascript:;">&nbsp;</a>
         </div>
         <div class="timeline-body" style="height: 300px;">
            <div class="timeline-header">
               <a href="/api/user/info">
                  <span class="userimage"><img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt=""></span>
                  <span class="username" id="cat-name"></span>
               </a>
            </div>
            <div class="timeline-content">
               <textarea class="form-control" placeholder="당신의 고양이를 자랑해보세요" id="context"
                  style="height: 150px"></textarea>
               <div style="padding-top: 10px;">
                  <input type="file">
                <button type="button" class="btn btn-outline-info" style="float: right;" onclick="new_post()">게시글
                     등록</button>
                
               </div>
            </div>
         </div>
      </div>
   </div>
</body>

</html>